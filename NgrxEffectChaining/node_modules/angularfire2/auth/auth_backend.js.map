{"version":3,"file":"auth_backend.js","sourceRoot":"","sources":["../../src/auth/auth_backend.ts"],"names":[],"mappings":"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","sourcesContent":["import * as firebase from 'firebase';\nimport { Observable } from 'rxjs/Observable';\n\nexport abstract class AuthBackend {\n  abstract authWithCustomToken(token: string): Promise<FirebaseAuthState>;\n  abstract authAnonymously(options?: any): Promise<FirebaseAuthState>;\n  abstract authWithPassword(credentials: EmailPasswordCredentials): Promise<FirebaseAuthState>;\n  abstract authWithOAuthPopup(provider: AuthProviders, options?: any): Promise<firebase.auth.UserCredential>;\n  abstract authWithOAuthRedirect(provider: AuthProviders, options?: any): Promise<void>;\n  abstract authWithOAuthToken(credentialsObj: firebase.auth.AuthCredential, options?: any)\n    : Promise<FirebaseAuthState>;\n  abstract onAuth(): Observable<FirebaseAuthState>;\n  abstract getAuth(): FirebaseAuthState;\n  abstract unauth(): Promise<void>;\n  abstract createUser(credentials: EmailPasswordCredentials): Promise<FirebaseAuthState>;\n  abstract getRedirectResult(): Observable<firebase.auth.UserCredential>;\n}\n\nexport enum AuthProviders {\n  Github,\n  Twitter,\n  Facebook,\n  Google,\n  Password,\n  Anonymous,\n  Custom\n};\n\nexport enum AuthMethods {\n  Popup,\n  Redirect,\n  Anonymous,\n  Password,\n  OAuthToken,\n  CustomToken\n};\n\nexport interface AuthConfiguration {\n  method?: AuthMethods;\n  provider?: AuthProviders;\n  scope?: string[];\n}\n\nexport interface FirebaseAuthState {\n  uid: string;\n  provider: AuthProviders;\n  auth: firebase.User;\n  expires?: number;\n  github?: firebase.UserInfo;\n  google?: firebase.UserInfo;\n  twitter?: firebase.UserInfo;\n  facebook?: firebase.UserInfo;\n  anonymous?: boolean;\n}\n\nexport function authDataToAuthState(authData: firebase.User, providerData?: firebase.UserInfo): FirebaseAuthState {\n  if (!authData) return null;\n  let providerId;\n  let { uid } = authData;\n  let authState: FirebaseAuthState = { auth: authData, uid, provider: null };\n  if (authData.isAnonymous) {\n    providerId = 'anonymous';\n    authState.provider = AuthProviders.Anonymous;\n    authState.anonymous = true;\n    return authState;\n  } else if (authData.providerData[0] === undefined || authData.providerData[0] === null) {\n    // There is no provider data, user is likely custom\n    providerId = 'custom';\n    authState.provider = AuthProviders.Custom;\n    return authState;\n  } else {\n    providerId = authData.providerData[0].providerId;\n  }\n\n  switch (providerId) {\n    case 'github.com':\n      authState.github = providerData;\n      authState.provider = AuthProviders.Github;\n      break;\n    case 'twitter.com':\n      authState.twitter = providerData;\n      authState.provider = AuthProviders.Twitter;\n      break;\n    case 'facebook.com':\n      authState.facebook = providerData;\n      authState.provider = AuthProviders.Facebook;\n      break;\n    case 'google.com':\n      authState.google = providerData;\n      authState.provider = AuthProviders.Google;\n      break;\n    case 'password':\n      authState.provider = AuthProviders.Password;\n      break;\n    case 'custom':\n      authState.provider = AuthProviders.Custom;\n      break;\n    default:\n      throw new Error(`Unsupported firebase auth provider ${providerId}`);\n  }\n\n  return authState;\n}\n\nexport function stripProviderId (providerId: string): string {\n  let providerStripped = /(.*)\\.com$/.exec(providerId);\n  if (providerStripped && providerStripped.length === 2) {\n    return providerStripped[1];\n  }\n  return null;\n}\n\nexport interface EmailPasswordCredentials {\n  email: string;\n  password: string;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}