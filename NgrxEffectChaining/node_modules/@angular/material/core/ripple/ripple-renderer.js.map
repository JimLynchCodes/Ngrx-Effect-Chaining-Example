{"version":3,"file":"ripple-renderer.js","sourceRoot":"","sources":["../../../../../src/lib/core/ripple/ripple-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import {ElementRef, NgZone} from '@angular/core';\nimport {ViewportRuler} from '../overlay/position/viewport-ruler';\n\n/** Fade-in speed in pixels per second. Can be modified with the speedFactor option. */\nexport const RIPPLE_SPEED_PX_PER_SECOND = 170;\n\n/** Fade-out speed for the ripples in milliseconds. This can't be modified by the speedFactor. */\nexport const RIPPLE_FADE_OUT_DURATION = 600;\n\n/**\n * Returns the distance from the point (x, y) to the furthest corner of a rectangle.\n */\nconst distanceToFurthestCorner = (x: number, y: number, rect: ClientRect) => {\n  const distX = Math.max(Math.abs(x - rect.left), Math.abs(x - rect.right));\n  const distY = Math.max(Math.abs(y - rect.top), Math.abs(y - rect.bottom));\n  return Math.sqrt(distX * distX + distY * distY);\n};\n\nexport type RippleConfig = {\n  color?: string;\n  centered?: boolean;\n  radius?: number;\n  speedFactor?: number;\n};\n\n/**\n * Helper service that performs DOM manipulations. Not intended to be used outside this module.\n * The constructor takes a reference to the ripple directive's host element and a map of DOM\n * event handlers to be installed on the element that triggers ripple animations.\n * This will eventually become a custom renderer once Angular support exists.\n * @docs-private\n */\nexport class RippleRenderer {\n\n  /** Element where the ripples are being added to. */\n  private _containerElement: HTMLElement;\n\n  /** Element which triggers the ripple elements on mouse events. */\n  private _triggerElement: HTMLElement;\n\n  /** Whether the mouse is currently down or not. */\n  private _isMousedown: boolean = false;\n\n  /** Currently active ripples that will be closed on mouseup. */\n  private _activeRipples: HTMLElement[] = [];\n\n  /** Events to be registered on the trigger element. */\n  private _triggerEvents = new Map<string, any>();\n\n  /** Ripple config for all ripples created by events. */\n  rippleConfig: RippleConfig = {};\n\n  /** Whether mouse ripples should be created or not. */\n  rippleDisabled: boolean = false;\n\n  constructor(_elementRef: ElementRef, private _ngZone: NgZone, private _ruler: ViewportRuler) {\n    this._containerElement = _elementRef.nativeElement;\n\n    // Specify events which need to be registered on the trigger.\n    this._triggerEvents.set('mousedown', this.onMousedown.bind(this));\n    this._triggerEvents.set('mouseup', this.onMouseup.bind(this));\n    this._triggerEvents.set('mouseleave', this.onMouseLeave.bind(this));\n\n    // By default use the host element as trigger element.\n    this.setTriggerElement(this._containerElement);\n  }\n\n  /** Fades in a ripple at the given coordinates. */\n  fadeInRipple(pageX: number, pageY: number, config: RippleConfig = {}) {\n    let containerRect = this._containerElement.getBoundingClientRect();\n\n    if (config.centered) {\n      pageX = containerRect.left + containerRect.width / 2;\n      pageY = containerRect.top + containerRect.height / 2;\n    } else {\n      // Subtract scroll values from the coordinates because calculations below\n      // are always relative to the viewport rectangle.\n      let scrollPosition = this._ruler.getViewportScrollPosition();\n      pageX -= scrollPosition.left;\n      pageY -= scrollPosition.top;\n    }\n\n    let radius = config.radius || distanceToFurthestCorner(pageX, pageY, containerRect);\n    let duration = 1 / (config.speedFactor || 1) * (radius / RIPPLE_SPEED_PX_PER_SECOND);\n    let offsetX = pageX - containerRect.left;\n    let offsetY = pageY - containerRect.top;\n\n    let ripple = document.createElement('div');\n    ripple.classList.add('mat-ripple-element');\n\n    ripple.style.left = `${offsetX - radius}px`;\n    ripple.style.top = `${offsetY - radius}px`;\n    ripple.style.height = `${radius * 2}px`;\n    ripple.style.width = `${radius * 2}px`;\n\n    // If the color is not set, the default CSS color will be used.\n    ripple.style.backgroundColor = config.color;\n    ripple.style.transitionDuration = `${duration}s`;\n\n    this._containerElement.appendChild(ripple);\n\n    // By default the browser does not recalculate the styles of dynamically created\n    // ripple elements. This is critical because then the `scale` would not animate properly.\n    this._enforceStyleRecalculation(ripple);\n\n    ripple.style.transform = 'scale(1)';\n\n    // Wait for the ripple to be faded in. Once it's faded in, the ripple can be hidden immediately\n    // if the mouse is released.\n    this.runTimeoutOutsideZone(() => {\n      this._isMousedown ? this._activeRipples.push(ripple) : this.fadeOutRipple(ripple);\n    }, duration * 1000);\n  }\n\n  /** Fades out a ripple element. */\n  fadeOutRipple(ripple: HTMLElement) {\n    ripple.style.transitionDuration = `${RIPPLE_FADE_OUT_DURATION}ms`;\n    ripple.style.opacity = '0';\n\n    // Once the ripple faded out, the ripple can be safely removed from the DOM.\n    this.runTimeoutOutsideZone(() => {\n      ripple.parentNode.removeChild(ripple);\n    }, RIPPLE_FADE_OUT_DURATION);\n  }\n\n  /** Sets the trigger element and registers the mouse events. */\n  setTriggerElement(element: HTMLElement) {\n    // Remove all previously register event listeners from the trigger element.\n    if (this._triggerElement) {\n      this._triggerEvents.forEach((fn, type) => this._triggerElement.removeEventListener(type, fn));\n    }\n\n    if (element) {\n      // If the element is not null, register all event listeners on the trigger element.\n      this._triggerEvents.forEach((fn, type) => element.addEventListener(type, fn));\n    }\n\n    this._triggerElement = element;\n  }\n\n  /** Listener being called on mousedown event. */\n  private onMousedown(event: MouseEvent) {\n    if (this.rippleDisabled) {\n      return;\n    }\n\n    this._isMousedown = true;\n    this.fadeInRipple(event.pageX, event.pageY, this.rippleConfig);\n  }\n\n  /** Listener being called on mouseup event. */\n  private onMouseup() {\n    this._isMousedown = false;\n    this._activeRipples.forEach(ripple => this.fadeOutRipple(ripple));\n    this._activeRipples = [];\n  }\n\n  /** Listener being called on mouseleave event. */\n  private onMouseLeave() {\n    if (this._isMousedown) {\n      this.onMouseup();\n    }\n  }\n\n  /** Runs a timeout outside of the Angular zone to avoid triggering the change detection. */\n  private runTimeoutOutsideZone(fn: Function, delay = 0) {\n    this._ngZone.runOutsideAngular(() => setTimeout(fn, delay));\n  }\n\n  /** Enforces a style recalculation of a DOM element by computing its styles. */\n  // TODO(devversion): Move into global utility function.\n  private _enforceStyleRecalculation(element: HTMLElement) {\n    // Enforce a style recalculation by calling `getComputedStyle` and accessing any property.\n    // Calling `getPropertyValue` is important to let optimizers know that this is not a noop.\n    // See: https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n    window.getComputedStyle(element).getPropertyValue('opacity');\n  }\n\n}\n"]}