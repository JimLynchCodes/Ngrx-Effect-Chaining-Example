{"version":3,"file":"dialog.js","sourceRoot":"","sources":["../../../../src/lib/dialog/dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import {Injector, ComponentRef, Injectable, Optional, SkipSelf, TemplateRef} from '@angular/core';\nimport {Observable} from 'rxjs/Observable';\nimport {Subject} from 'rxjs/Subject';\nimport {Overlay, OverlayRef, ComponentType, OverlayState, ComponentPortal} from '../core';\nimport {extendObject} from '../core/util/object-extend';\nimport {ESCAPE} from '../core/keyboard/keycodes';\nimport {DialogInjector} from './dialog-injector';\nimport {MdDialogConfig} from './dialog-config';\nimport {MdDialogRef} from './dialog-ref';\nimport {MdDialogContainer} from './dialog-container';\nimport {TemplatePortal} from '../core/portal/portal';\n\n\n// TODO(jelbourn): animations\n\n\n\n/**\n * Service to open Material Design modal dialogs.\n */\n@Injectable()\nexport class MdDialog {\n  private _openDialogsAtThisLevel: MdDialogRef<any>[] = [];\n  private _afterAllClosedAtThisLevel = new Subject<void>();\n  private _afterOpenAtThisLevel = new Subject<MdDialogRef<any>>();\n  private _boundKeydown = this._handleKeydown.bind(this);\n\n  /** Keeps track of the currently-open dialogs. */\n  get _openDialogs(): MdDialogRef<any>[] {\n    return this._parentDialog ? this._parentDialog._openDialogs : this._openDialogsAtThisLevel;\n  }\n\n  /** Subject for notifying the user that all open dialogs have finished closing. */\n  get _afterOpen(): Subject<MdDialogRef<any>> {\n    return this._parentDialog ? this._parentDialog._afterOpen : this._afterOpenAtThisLevel;\n  }\n  /** Subject for notifying the user that a dialog has opened. */\n  get _afterAllClosed(): Subject<void> {\n    return this._parentDialog ?\n      this._parentDialog._afterAllClosed : this._afterAllClosedAtThisLevel;\n  }\n\n  /** Gets an observable that is notified when a dialog has been opened. */\n  afterOpen: Observable<MdDialogRef<any>> = this._afterOpen.asObservable();\n\n  /** Gets an observable that is notified when all open dialog have finished closing. */\n  afterAllClosed: Observable<void> = this._afterAllClosed.asObservable();\n\n  constructor(\n      private _overlay: Overlay,\n      private _injector: Injector,\n      @Optional() @SkipSelf() private _parentDialog: MdDialog) { }\n\n  /**\n   * Opens a modal dialog containing the given component.\n   * @param componentOrTemplateRef Type of the component to load into the dialog,\n   *     or a TemplateRef to instantiate as the dialog content.\n   * @param config Extra configuration options.\n   * @returns Reference to the newly-opened dialog.\n   */\n  open<T>(componentOrTemplateRef: ComponentType<T> | TemplateRef<T>,\n          config?: MdDialogConfig): MdDialogRef<T> {\n    config = _applyConfigDefaults(config);\n\n    let overlayRef = this._createOverlay(config);\n    let dialogContainer = this._attachDialogContainer(overlayRef, config);\n    let dialogRef =\n        this._attachDialogContent(componentOrTemplateRef, dialogContainer, overlayRef, config);\n\n    if (!this._openDialogs.length && !this._parentDialog) {\n      document.addEventListener('keydown', this._boundKeydown);\n    }\n\n    this._openDialogs.push(dialogRef);\n    dialogRef.afterClosed().subscribe(() => this._removeOpenDialog(dialogRef));\n    this._afterOpen.next(dialogRef);\n\n    return dialogRef;\n  }\n\n  /**\n   * Closes all of the currently-open dialogs.\n   */\n  closeAll(): void {\n    let i = this._openDialogs.length;\n\n    while (i--) {\n      // The `_openDialogs` property isn't updated after close until the rxjs subscription\n      // runs on the next microtask, in addition to modifying the array as we're going\n      // through it. We loop through all of them and call close without assuming that\n      // they'll be removed from the list instantaneously.\n      this._openDialogs[i].close();\n    }\n  }\n\n  /**\n   * Creates the overlay into which the dialog will be loaded.\n   * @param dialogConfig The dialog configuration.\n   * @returns A promise resolving to the OverlayRef for the created overlay.\n   */\n  private _createOverlay(dialogConfig: MdDialogConfig): OverlayRef {\n    let overlayState = this._getOverlayState(dialogConfig);\n    return this._overlay.create(overlayState);\n  }\n\n  /**\n   * Attaches an MdDialogContainer to a dialog's already-created overlay.\n   * @param overlay Reference to the dialog's underlying overlay.\n   * @param config The dialog configuration.\n   * @returns A promise resolving to a ComponentRef for the attached container.\n   */\n  private _attachDialogContainer(overlay: OverlayRef, config: MdDialogConfig): MdDialogContainer {\n    let viewContainer = config ? config.viewContainerRef : null;\n    let containerPortal = new ComponentPortal(MdDialogContainer, viewContainer);\n\n    let containerRef: ComponentRef<MdDialogContainer> = overlay.attach(containerPortal);\n    containerRef.instance.dialogConfig = config;\n\n    return containerRef.instance;\n  }\n\n  /**\n   * Attaches the user-provided component to the already-created MdDialogContainer.\n   * @param componentOrTemplateRef The type of component being loaded into the dialog,\n   *     or a TemplateRef to instantiate as the content.\n   * @param dialogContainer Reference to the wrapping MdDialogContainer.\n   * @param overlayRef Reference to the overlay in which the dialog resides.\n   * @param config The dialog configuration.\n   * @returns A promise resolving to the MdDialogRef that should be returned to the user.\n   */\n  private _attachDialogContent<T>(\n      componentOrTemplateRef: ComponentType<T> | TemplateRef<T>,\n      dialogContainer: MdDialogContainer,\n      overlayRef: OverlayRef,\n      config?: MdDialogConfig): MdDialogRef<T> {\n    // Create a reference to the dialog we're creating in order to give the user a handle\n    // to modify and close it.\n    let dialogRef = <MdDialogRef<T>> new MdDialogRef(overlayRef, config);\n\n    if (!config.disableClose) {\n      // When the dialog backdrop is clicked, we want to close it.\n      overlayRef.backdropClick().first().subscribe(() => dialogRef.close());\n    }\n\n    // Set the dialogRef to the container so that it can use the ref to close the dialog.\n    dialogContainer.dialogRef = dialogRef;\n\n    // We create an injector specifically for the component we're instantiating so that it can\n    // inject the MdDialogRef. This allows a component loaded inside of a dialog to close itself\n    // and, optionally, to return a value.\n    let userInjector = config && config.viewContainerRef && config.viewContainerRef.injector;\n    let dialogInjector = new DialogInjector(userInjector || this._injector, dialogRef, config.data);\n\n    if (componentOrTemplateRef instanceof TemplateRef) {\n      dialogContainer.attachTemplatePortal(new TemplatePortal(componentOrTemplateRef, null));\n    } else {\n      let contentRef = dialogContainer.attachComponentPortal(\n          new ComponentPortal(componentOrTemplateRef, null, dialogInjector));\n      dialogRef.componentInstance = contentRef.instance;\n    }\n\n    return dialogRef;\n  }\n\n  /**\n   * Creates an overlay state from a dialog config.\n   * @param dialogConfig The dialog configuration.\n   * @returns The overlay configuration.\n   */\n  private _getOverlayState(dialogConfig: MdDialogConfig): OverlayState {\n    let state = new OverlayState();\n    let strategy = this._overlay.position().global();\n    let position = dialogConfig.position;\n\n    state.hasBackdrop = true;\n    state.positionStrategy = strategy;\n\n    if (position && (position.left || position.right)) {\n      position.left ? strategy.left(position.left) : strategy.right(position.right);\n    } else {\n      strategy.centerHorizontally();\n    }\n\n    if (position && (position.top || position.bottom)) {\n      position.top ? strategy.top(position.top) : strategy.bottom(position.bottom);\n    } else {\n      strategy.centerVertically();\n    }\n\n    strategy.width(dialogConfig.width).height(dialogConfig.height);\n\n    return state;\n  }\n\n  /**\n   * Removes a dialog from the array of open dialogs.\n   * @param dialogRef Dialog to be removed.\n   */\n  private _removeOpenDialog(dialogRef: MdDialogRef<any>) {\n    let index = this._openDialogs.indexOf(dialogRef);\n\n    if (index > -1) {\n      this._openDialogs.splice(index, 1);\n\n      // no open dialogs are left, call next on afterAllClosed Subject\n      if (!this._openDialogs.length) {\n        this._afterAllClosed.next();\n        document.removeEventListener('keydown', this._boundKeydown);\n      }\n    }\n  }\n\n  /**\n   * Handles global key presses while there are open dialogs. Closes the\n   * top dialog when the user presses escape.\n   */\n  private _handleKeydown(event: KeyboardEvent): void {\n    let topDialog = this._openDialogs[this._openDialogs.length - 1];\n\n    if (event.keyCode === ESCAPE && topDialog && !topDialog.config.disableClose) {\n      topDialog.close();\n    }\n  }\n}\n\n/**\n * Applies default options to the dialog config.\n * @param dialogConfig Config to be modified.\n * @returns The new configuration object.\n */\nfunction _applyConfigDefaults(dialogConfig: MdDialogConfig): MdDialogConfig {\n  return extendObject(new MdDialogConfig(), dialogConfig);\n}\n\n"]}